Thunderhead=window.Thunderhead||{},Thunderhead.rmi=Thunderhead.rmi||{};var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Thunderhead.rmi.Controller=function(){},Thunderhead.rmi.Controller.prototype={DEFAULT_TIMEOUT:1e4,config:{container:document.body,visible:!1,remoteProxy:"",commandWindowName:"",remoteWindowName:"",remoteWindow:null,method:"post",thunderheadServer:"",clientServer:""},initialized:!1,commands:null,init:function(e){if(e&&"object"===("undefined"==typeof e?"undefined":_typeof(e))){var t;for(t in e)e.hasOwnProperty(t)&&(this.config[t]=e[t])}this.commands=e.commands||{},this._formBased=!this.isMessagingSupported()||!(e.thunderheadServer||e.clientServer),this._formBased?this._initFormBased():(this._expectedMessageOrigin=e.thunderheadServer||e.clientServer,this._initMessagingBased())},setCommands:function(e){this.commands=e},setCommand:function(e,t){this.commands[e]=t},isMessagingSupported:function(){return Boolean(window.postMessage)},_initFormBased:function(){this.config.method="post"===this.config.method||"get"===this.config.method?this.config.method:"post",this.config.commandFormName=this.config.commandWindowName+"__Form",this._rmiDiv=document.createElement("div");var e='<div id="thunderheadRMI" style="'+(this.config.visible?"":"position:absolute;width:1px;height:1px;top:0px;left:-999px")+'">';e+='    <iframe name="'+this.config.commandWindowName+'" src="" frameborder="1" width="100%" height="100" tabindex="-1"></iframe>',e+='    <form id="'+this.config.commandFormName+'" action="'+this.config.remoteProxy+'" method="'+this.config.method+'" target="'+this.config.commandWindowName+'">',e+='        <input type="hidden" name="command" />',e+='        <input type="hidden" name="object" />',e+='        <input type="hidden" name="callback" />',e+='        <input type="hidden" name="windowName" value="'+this.config.remoteWindowName+'" />',e+="    </form>",e+="</div>",this._rmiDiv.innerHTML=e,this.config.container=document.getElementById(this.config.container)||document.body,null!==this.config.container&&(this.config.container.appendChild(this._rmiDiv),this._commandForm=document.getElementById(this.config.commandFormName),this.initialized=!0)},_initMessagingBased:function(){var e=this;e._messageListener=function(t){if(t=t||window.event,t.origin===e._expectedMessageOrigin)try{var n=e._decodeJSON(t.data);e.receiveCommand(n.command,n.args,n.callback)}catch(e){}},window.addEventListener?window.addEventListener("message",e._messageListener,!1):window.attachEvent("onmessage",e._messageListener),this.initialized=!0},isInitialized:function(){return this.initialized},isMessagingBased:function(){if(!this.initialized)throw new Error("Thunderhead.RMI is not initialized");return!this._formBased},destroy:function(){this.initialized===!0&&(this._formBased?this._rmiDiv.parentNode.removeChild(this._rmiDiv):window.removeEventListener?window.removeEventListener("message",this._messageListener,!1):window.detachEvent("onmessage",this._messageListener),this.initialized=!1,this.commands={})},receiveCommand:function(e,t,n){var i=this;if(!i.initialized)return!1;var a=i.commands[e];if("[object Function]"===Object.prototype.toString.apply(a)){var o;i._formBased&&i._isString(t)?(o=i._decodeJSON(t),o.__isPrimitive===!0&&(o=this._isString(o.primitive)?decodeURIComponent(o.primitive):o.primitive)):i._formBased||(o=t),a.call(i.commands,o,function(e){i._isString(n)&&"undefined"!==n&&i.sendCommand(n,e)})}return!0},sendCommand:function(e,t,n,i){var a=this;if(!a.initialized||a._formBased&&null===a._commandForm)return!1;var o=n;if(this._isString(o)||(o=this._storeCallbackCommand(e,n,i)),a._formBased){var r=a._commandForm;r.elements.command.value=e,this._isPrimitive(t)&&(t={__isPrimitive:!0,primitive:this._isString(t)?encodeURIComponent(t):t}),r.elements.object.value=a._encodeJSON(t),r.elements.callback.value=this._isString(o)?o:"undefined",r.submit()}else{var d;if(this.config.remoteWindow)d=this.config.remoteWindow;else{var s=this.config.remoteWindowName;d=""===s?window.parent:window.frames[s]}var m={command:e,args:t,callback:o};d.postMessage(a._encodeJSON(m),"*")}return!0},_storeCallbackCommand:function(e,t,n){if(t){var i,a=this;do i=e+"_"+this._getUniqueStamp();while("undefined"!=typeof a.commands[i]);return a.commands[i]=function(e){delete a.commands[i],t.call(n,!0,e)},setTimeout(function(){"undefined"!=typeof a.commands[i]&&(delete a.commands[i],t.call(n,!1))},this.DEFAULT_TIMEOUT),i}},_getUniqueStamp:function(){return Math.floor(1048576*Math.random()).toString()},_isPrimitive:function(e){return"number"==typeof e&&isFinite(e)||"boolean"==typeof e||"string"==typeof e},_isString:function(e){return"string"==typeof e},_decodeJSON:function(e){if(0===e.length)return e;if("/*"===e.substr(0,2))e=e.substring(2,e.length-2);else{if("while(1);"!==e.substr(0,9))throw new SyntaxError("This JSON data is not protected against JavaScript Hijacks.");e=e.substring(9)}return"undefined"!==e?JSON.parse(e):void 0},_encodeJSON:function(e){return"while(1);"+JSON.stringify(e)}},Thunderhead.RMI=Thunderhead.rmi.Controller,Thunderhead.DataCaptureComponent=function(e){this._initialize(e)},Thunderhead.DataCaptureRMI=new Thunderhead.RMI({}),Thunderhead.DataCaptureComponent.prototype={_listeners:[],WINDOW_NAME:"dataCaptureComponentWindow",DATA_CAPTURE_CONTEXT:"/one/data-capture",DATA_CAPTURE_PAGE_NAME:"interview.jsp",DEFAULT_TIMEOUT:1e4,interviewReady:null,interviewSessionExpired:null,beforePageLoaded:null,afterPageLoaded:null,interviewStarted:null,interviewCancelled:null,interviewCompleted:null,interviewFailed:null,fieldChanged:null,buttonClicked:null,interviewSubmitted:null,_initialize:function(e){if(e=e||{},this._listeners=[],e.isLocal=this._local=!e.server,e.isLocal)Thunderhead.DataCaptureRMI.setCommands(this._getClientCommands(e)),this.initialized=!0;else if(Thunderhead.DataCaptureRMI.init({container:document.body,remoteWindowName:this.WINDOW_NAME,commandWindowName:"host_th",thunderheadServer:e.server,commands:this._getClientCommands(e)}),this.initialized=Thunderhead.DataCaptureRMI.isInitialized(),!this.initialized)throw new Error("Could not initialize RMI framework.");this._createApplicationWindow(e)},_getDefaultPageDomain:function(){var e=""!==location.port?":"+window.location.port:"";return location.protocol+"//"+location.hostname+e},_createApplicationWindow:function(e){var t;if(e.hasOwnProperty("targetElementID")){if(t=document.getElementById(e.targetElementID),!t)throw new Error('Cannot find element with ID "'+e.targetElementID+'"');delete e.targetElementID}else t=document.body;var n=document.createElement("iframe");n.setAttribute("name",this.WINDOW_NAME),n.setAttribute("id",this.WINDOW_NAME),n.setAttribute("title","Data Capture Component"),n.setAttribute("frameborder",0),n.setAttribute("width","100%"),n.setAttribute("height","100%");var i=this._getDefaultPageDomain(),a=this._addURIParam("","templateResourceId",e.templateResourceId);a=this._addURIParam(a,"versionId",e.templateResourceVersionId),a=this._addURIParam(a,"projectId",e.projectId),a=this._addURIParam(a,"name",e.name),a=this._addURIParam(a,"hostDomain",i,!0),a=this._addURIParam(a,"interviewServiceUrl",e.interviewServiceUrl,!0),e.isLocal&&(a=this._addURIParam(a,"isLocal","true"));var o="undefined"==typeof e.server||0===e.server.length||e.server===i,r=Thunderhead.isTopFrameSameDomain&&o?"&internal=true":"",d=(e.server||i)+(e.context||this.DATA_CAPTURE_CONTEXT)+"/"+this.DATA_CAPTURE_PAGE_NAME+"?"+a+r;e.authUrl&&e.authParams?n.setAttribute("src",e.authUrl+"?state="+encodeURIComponent(d)+"&"+e.authParams):n.setAttribute("src",d),t.appendChild(n)},_addURIParam:function(e,t,n,i){return"undefined"!=typeof n&&n.length>0&&(n=n||"",n=i?encodeURIComponent(n):n,0!==e.length&&(e+="&"),e+=t+"="+n),e},_getClientCommands:function(e){var t=this;return{fireEvent:function(e){t._fireEvent(e[0],e[1])},loadStartupConfig:function(t,n){e.loadStartupConfig&&n(e.loadStartupConfig())},beforeValidate:function(t,n){n(e.callbacks&&e.callbacks.beforePageValidated?e.callbacks.beforePageValidated():null)},afterValidate:function(t,n){n(e.callbacks&&e.callbacks.afterPageValidated()?e.callbacks.afterPageValidated():null)}}},_sendCommand:function(e,t,n,i){if(i=i||this,this._local){var a=window.frames[this.WINDOW_NAME].Thunderhead.DataCaptureRMI.commands;a[e].call(a,t,function(e){n&&n.call(i,!0,e)})}else Thunderhead.DataCaptureRMI.sendCommand(e,t,n,i)},_fireEvent:function(e,t){var n;for(n=0;n<this._listeners.length;n++){var i=this._listeners[n][e];i&&i(t)}},destroy:function(){Thunderhead.DataCaptureRMI.destroy();var e=document.getElementById(this.WINDOW_NAME);e&&e.parentNode.removeChild(e)},addListener:function(e){this._listeners.push(e)},removeListener:function(e){var t;for(t=0;t<this._listeners.length;t++)this._listeners[t]===e&&this._listeners.splice(t,1)},startInterviewForResource:function(e,t,n,i){this._sendCommand("startInterviewForResource",{projectId:e,templateResourceId:t,templateVersionId:n,interviewName:i})},isInterviewChanged:function(e){this._sendCommand("isInterviewChanged",{},e)},isPageChanged:function(e){this._sendCommand("isPageChanged",{},e)},getInterviewId:function(e){this._sendCommand("getInterviewId",{},e)},getCurrentPageKey:function(e){this._sendCommand("getCurrentPageKey",{},e)},setCurrentPageByKey:function(e,t){this._sendCommand("setCurrentPageByKey",{pageKey:e,discardChanges:t})},getCurrentPageTitle:function(e){this._sendCommand("getCurrentPageTitle",{},e)},getTransactionData:function(e){this._sendCommand("getTransactionData",{},e)},setTransactionData:function(e){this._sendCommand("setTransactionData",{xml:e})},loadDataFromURL:function(e,t){this._sendCommand("loadDataFromURL",{url:e},t)},saveDataToURL:function(e,t){this._sendCommand("saveDataToURL",{url:e},t)},setRemoveEmptyFields:function(e){this._sendCommand("setRemoveEmptyFields",{enabled:e})},setDataTemplate:function(e){this._sendCommand("setDataTemplate",{xml:e})},loadDataTemplateFromURL:function(e,t){this._sendCommand("loadDataTemplateFromURL",{url:e},t)},isRemoveEmptyFields:function(e){this._sendCommand("isRemoveEmptyFields",{},e)},isFieldEnabled:function(e,t){this._sendCommand("isFieldEnabled",{path:e},t)},setFieldEnabled:function(e,t){this._sendCommand("setFieldEnabled",{path:e,value:t})},getRepeatRowCount:function(e,t){this._sendCommand("getRepeatRowCount",{path:e},t)},addRepeatRow:function(e){this._sendCommand("addRepeatRow",{path:e})},deleteRepeatRow:function(e){this._sendCommand("deleteRepeatRow",{path:e})},getField:function(e,t){this._sendCommand("getField",{path:e},t)},setField:function(e,t){this._sendCommand("setField",{path:e,value:t})},next:function(){this._sendCommand("next",{})},back:function(e){this._sendCommand("back",{discardChanges:e})},cancel:function(){this._sendCommand("cancel",{})},getThxInterviewForm:function(e){this._sendCommand("getThxInterviewForm",{},e)},getXForm:function(e){this._sendCommand("getXForm",{},e)},setXForm:function(e){this._sendCommand("setXForm",{xform:e})}};var DataCaptureLoadStartUpConfig_v1={};